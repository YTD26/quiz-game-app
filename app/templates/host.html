<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Host Dashboard</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .host-container { max-width: 1000px; }
        .control-panel { background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container host-container">
        <h1>ðŸŽ® Host Dashboard</h1>
        
        <div class="game-code-display">
            <h2>Game Code</h2>
            <div class="code" id="gameCode">{{ game_code }}</div>
        </div>
        
        <div class="player-list">
            <h2>Spelers (<span id="playerCount">0</span>)</h2>
            <div id="playersList"></div>
        </div>
        
        <div class="control-panel">
            <h3>Game Controls</h3>
            <button id="startGameBtn" class="btn btn-success btn-block" onclick="startGame()">Start Quiz</button>
            <button id="nextQuestionBtn" class="btn btn-primary btn-block" onclick="nextQuestion()" style="display:none;">Volgende Vraag</button>
            <button id="showResultsBtn" class="btn btn-secondary btn-block" onclick="showResults()" style="display:none;">Toon Resultaten</button>
        </div>
        
        <div id="statusMessage" class="alert alert-info">
            Wachten op spelers...
        </div>
    </div>
    
    <script>
        const gameCode = '{{ game_code }}';
        const playerName = 'Host';
        
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const ws = new WebSocket(`${protocol}//${window.location.host}/ws/${gameCode}/${playerName}`);
        
        ws.onmessage = (event) => {
            const message = JSON.parse(event.data);
            
            switch(message.type) {
                case 'player_joined':
                case 'player_left':
                    loadPlayers();
                    break;
                    
                case 'question_start':
                    document.getElementById('startGameBtn').style.display = 'none';
                    document.getElementById('nextQuestionBtn').style.display = 'block';
                    document.getElementById('statusMessage').textContent = `Vraag ${message.data.question_number} wordt gespeeld...`;
                    break;
                    
                case 'game_finished':
                    document.getElementById('nextQuestionBtn').style.display = 'none';
                    document.getElementById('showResultsBtn').style.display = 'block';
                    document.getElementById('statusMessage').textContent = 'Quiz afgelopen!';
                    break;
            }
        };
        
        async function loadPlayers() {
            try {
                const response = await fetch(`/api/game/${gameCode}/players`);
                const players = await response.json();
                
                const playersList = document.getElementById('playersList');
                playersList.innerHTML = '';
                
                players.forEach(player => {
                    const playerDiv = document.createElement('div');
                    playerDiv.className = 'player-item';
                    playerDiv.innerHTML = `
                        <span class="player-name">${player.player_name}</span>
                        <span class="player-status" style="background: ${player.is_connected ? 'var(--secondary-color)' : '#95a5a6'}"></span>
                    `;
                    playersList.appendChild(playerDiv);
                });
                
                document.getElementById('playerCount').textContent = players.length;
            } catch (error) {
                console.error('Error loading players:', error);
            }
        }
        
        function startGame() {
            ws.send(JSON.stringify({type: 'start_game'}));
            document.getElementById('statusMessage').textContent = 'Quiz gestart!';
            document.getElementById('statusMessage').className = 'alert alert-success';
        }
        
        function nextQuestion() {
            ws.send(JSON.stringify({type: 'next_question'}));
        }
        
        function showResults() {
            window.location.href = `/results/${gameCode}`;
        }
        
        loadPlayers();
    </script>
</body>
</html>